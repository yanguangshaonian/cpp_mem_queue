# cpp_mem_queue
一个基于共享内存的c++消息队列

### 极致性能
基于 std::atomic 内存序和 RingBuffer 设计, 生产者与消费者之间通过共享内存直接交互, 无内核态拷贝开销. 

### 零拷贝 API
通过 Lambda 回调直接操作共享内存中的对象引用, 避免数据的 memcpy. 

### 多模式支持

#### 极速模式 (Spinning)

使用 pause 指令自旋, 在单生产者/单消费者下在我本地虚拟机不绑核降频的情况下每次发送大小16bytes数据, 每秒吞吐量 5000w. 在 单生产者/双消费者 吞吐量降低至3100w. 在单生产者/三消费者 吞吐量降低至2300w.

#### 节能模式 (Futex)
无数据时挂起线程, 由生产者唤醒, 平衡延迟与 CPU 功耗. 

#### 抢占模式 (Competing)
支持多消费者抢占任务(Work Stealing), 适合负载均衡场景. 

### 内存优化
自动尝试使用 2MB HugePages, 减少 TLB Miss; 数据结构自动对齐 Cache Line (64B), 避免伪共享(False Sharing). 

### 健壮性
内置 Magic Number 握手、版本校验和死锁恢复机制(检测到文件损坏自动重建).

### 自由定制
可以自由设置对齐大小, 以应对不同的情景以平衡cpu总线和缓存行风暴导致的不同性能差异